{% extends "layout.html" %}

{% block title %} Listado de Cobros {% endblock %}

{% block content %}
    <h1>Listado de Cobros</h1>

    {% if success_cobro %}
    <div class="alert alert-success" role="alert">
        {{ success_cobro }}
    </div>
    {% endif %}

    {% if is_authenticated(session) and check_permission(session, "cobro_create") %}
    <div class="actions mb-4">
        <a href="{{ url_for('cobros.registrar_cobro') }}" class="btn btn-add">Registrar Cobro</a>
    </div>
    {% endif %}

    <form method="GET" action="{{ url_for('cobros.listar_cobros') }}" class="mb-3 search-form">
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="fecha_inicio">Fecha Inicio:</label>
                <input type="date" id="fecha_inicio" name="fecha_inicio" class="form-control" value="{{ fecha_inicio }}">
            </div>
    
            <div class="form-group col-md-4">
                <label for="fecha_fin">Fecha Fin:</label>
                <input type="date" id="fecha_fin" name="fecha_fin" class="form-control" value="{{ fecha_fin }}">
            </div>
            
            <div class="form-group col-md-4">
                <label for="nombre_recibido">Nombre del que recibió el dinero:</label>
                <input type="text" id="nombre_recibido" name="nombre_recibido" class="form-control" value="{{ nombre_recibido }}">
            </div>
    
            <div class="form-group col-md-4">
                <label for="apellido_recibido">Apellido del que recibió el dinero:</label>
                <input type="text" id="apellido_recibido" name="apellido_recibido" class="form-control" value="{{ apellido_recibido }}">
            </div>
    
            <div class="form-group col-md-4">
                <label for="medio_pago">Medio de Pago:</label>
                <select id="medio_pago" name="medio_pago" class="form-control">
                    <option value="" {% if medio_pago == "" %}selected{% endif %}>Todos</option>
                    <option value="efectivo" {% if medio_pago == "efectivo" %}selected{% endif %}>Efectivo</option>
                    <option value="tarjeta_credito" {% if medio_pago == "tarjeta_credito" %}selected{% endif %}>Tarjeta de Crédito</option>
                    <option value="tarjeta_debito" {% if medio_pago == "tarjeta_debito" %}selected{% endif %}>Tarjeta de Débito</option>
                </select>
            </div>
        </div>
    
        <div class="form-group text-center">
            <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
    </form>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Jinete o Amazona</th>
                <th>
                    <a href="{{ url_for('cobros.listar_cobros', orden='asc', fecha_inicio=fecha_inicio, fecha_fin=fecha_fin, medio_pago=medio_pago, nombre_recibido=nombre_recibido, apellido_recibido=apellido_recibido, page=pagination.page) }}">Fecha de Pago &#9650;</a> 
                    <a href="{{ url_for('cobros.listar_cobros', orden='desc', fecha_inicio=fecha_inicio, fecha_fin=fecha_fin, medio_pago=medio_pago, nombre_recibido=nombre_recibido, apellido_recibido=apellido_recibido, page=pagination.page) }}">&#9660;</a>
                </th>
                <th>Medio de Pago</th>
                <th>Monto</th>
                <th>Recibido por</th>
                <th>Observaciones</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for cobro in cobros_realizado %}
            <tr>
                <td>{{ cobro.jinete.nombre }} {{ cobro.jinete.apellido }}</td>
                <td>{{ cobro.fecha_pago.strftime('%Y-%m-%d') }}</td>
                <td>{{ cobro.medio_pago.capitalize() }}</td>
                <td>{{ cobro.monto }}</td>
                <td>{{ cobro.empleado.nombre }} {{ cobro.empleado.apellido }}</td>
                <td>{{ cobro.observaciones }}</td>
                <td>
                    {% if is_authenticated(session) and check_permission(session, "cobro_destroy") %}
                    <form method="POST" action="{{ url_for('cobros.eliminar_cobro', id=cobro.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-delete" onclick="return confirm('¿Estás seguro de que deseas eliminar este cobro?');">Eliminar</button>
                    </form>
                    {% endif %}
                    {% if is_authenticated(session) and check_permission(session, "cobro_update") %}                    
                    <a href="{{ url_for('cobros.editar_cobro', id=cobro.id) }}" class="btn btn-edit">Editar</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if cobros_realizado|length == 0 %}
    <p class="text-center">No se encontraron cobros registrados con los filtros aplicados.</p>
    {% endif %}

    <nav aria-label="Paginación">
        <ul class="pagination">
            {% if pagina_actual > 1 %}
            <li class="page-item">
                <a class="page-link" href="?page={{ pagina_actual - 1 }}&orden={{ orden }}&medio_pago={{ medio_pago }}&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}&nombre_recibido={{ nombre_recibido }}&apellido_recibido={{ apellido_recibido }}">
                    «
                </a>
            </li>
            {% endif %}
            {% for p in range(1, total_paginas + 1) %}
            <li class="page-item {% if p == pagina_actual %}active{% endif %}">
                <a class="page-link" href="?page={{ p }}&orden={{ orden }}&medio_pago={{ medio_pago }}&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}&nombre_recibido={{ nombre_recibido }}&apellido_recibido={{ apellido_recibido }}">
                    {{ p }}
                </a>
            </li>
            {% endfor %}
            {% if pagina_actual < total_paginas %}
            <li class="page-item">
                <a class="page-link" href="?page={{ pagina_actual + 1 }}&orden={{ orden }}&medio_pago={{ medio_pago }}&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}&nombre_recibido={{ nombre_recibido }}&apellido_recibido={{ apellido_recibido }}">
                    »
                </a>
            </li>
            {% endif %}
        </ul>
      </nav>
      
{% endblock %}