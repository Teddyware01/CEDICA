{% extends "layout.html" %}

{% block title %} Editar Cliente {% endblock %}

{% block content %}
    <h1 class="text-center">Editar Cliente</h1>

    <form action="{{ url_for('users.update_user', user_id=user.id) }}" method="POST" onsubmit="return validateRoles()">
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{ user.email }}" required>
        </div>

        <div class="form-group">
            <label for="alias">Alias</label>
            <input type="text" id="alias" name="alias" value="{{ user.alias }}" required>
        </div>

        <div class="form-group">
            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" value="{{ user.password }}" required>
        </div>

        <div class="form-group">
            <label for="is_admin">¿Es administrador del sistema?</label>
            <input type="checkbox" id="is_admin" name="is_admin" {% if user.system_admin %}checked{% endif %}>
        </div>

        <div class="form-group">
            <label for="is_active">¿Está activo?</label>
            <input type="checkbox" id="is_active" name="is_active" {% if user.activo %}checked{% endif %}>
        </div>

        <div class="form-group">
            <label for="roles">Roles (debe tener al menos uno):</label>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="roles" value="Tecnica" {% if 'Tecnica' in roles %}checked{% endif %}>
                    Técnica
                </label>
                <label>
                    <input type="checkbox" name="roles" value="Encuestre" {% if 'Encuestre' in roles %}checked{% endif %}>
                    Ecuestre
                </label>
                <label>
                    <input type="checkbox" name="roles" value="Voluntariado" {% if 'Voluntariado' in roles %}checked{% endif %}>
                    Voluntariado
                </label>
                <label>
                    <input type="checkbox" name="roles" value="Administracion" {% if 'Administracion' in roles %}checked{% endif %}>
                    Administración
                </label>
            </div>
            <small class="form-text text-muted">Debe seleccionar al menos un rol.</small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-submit">Guardar Cambios</button>
            <a href="{{ url_for('users.listar_usuarios') }}" class="btn btn-cancel">Cancelar</a>
        </div>
    </form>

    <script>
        function validateRoles() {
            // Obtiene todos los checkboxes de roles
            const checkboxes = document.querySelectorAll('input[name="roles"]');
            // Revisa si al menos uno está marcado
            let isChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);

            if (!isChecked) {
                alert("Debe seleccionar al menos un rol.");
                return false; // Evita que se envíe el formulario
            }
            return true; // Permite el envío del formulario
        }
    </script>
{% endblock %}
