{% extends "layout.html" %}

{% block title %} Listado de Clientes {% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}

{% block navbar %}
    <nav>
        <ul>
            <li><a href="/">Inicio</a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    <h1 class="text-center">Listado de Clientes</h1>

    <div class="actions">
        <a href="{{ url_for('users.add_client_form') }}" class="btn btn-add">Agregar Cliente</a>
    </div>

    <form method="GET" action="{{ url_for('users.listar_usuarios') }}" class="mb-3">
        <label for="sort_by">Ordenar por:</label>
        <select name="sort_by" id="sort_by">
            <option value="email_asc">Email (Ascendente)</option>
            <option value="email_desc">Email (Descendente)</option>
            <option value="created_at_asc">Fecha de Creación (Ascendente)</option>
            <option value="created_at_desc">Fecha de Creación (Descendente)</option>
        </select>
        <button type="submit" class="btn btn-sort">Ordenar</button>
    </form>

    <table class="table">
        <thead>
            <tr>
                <th>Email</th>
                <th>Alias</th>
                <th>System Admin</th>
                <th>Activo</th>
                <th>Fecha de Creación</th> 
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for user in usuarios %}
            <tr>
                <td>{{ user.email }}</td>
                <td>{{ user.alias }}</td>
                <td>{{ 'Sí' if user.system_admin else 'No' }}</td>
                <td>{{ 'Sí' if user.activo else 'No' }}</td>
                <td>{{ user.fecha_creacion.strftime('%Y-%m-%d %H:%M:%S') }}</td> 
                <td>
                    <a href="{{ url_for('users.mostrar_usuario', user_id=user.id) }}" class="btn btn btn-edit">Ver</a>
                    <a href="{{ url_for('users.edit_client_form', user_id=user.id) }}" class="btn btn-edit">Editar</a>
                    <a href="{{ url_for('users.delete_client_form', user_id=user.id) }}" class="btn btn-delete">Eliminar</a>
                    
                    {% if user.activo %}
                        <form method="POST" action="{{ url_for('users.block_user', user_id=user.id) }}" style="display:inline;">
                            <button type="submit" class="btn btn-block">Bloquear</button>
                        </form>
                    {% else %}
                        <form method="POST" action="{{ url_for('users.activate_user', user_id=user.id) }}" style="display:inline;">
                            <button type="submit" class="btn btn-activate">Activar</button>
                        </form>
                    {% endif %}
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
          <!-- Botón para retroceder (solo si hay página anterior) -->
          {% if usuarios.has_prev %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('users.listar_usuarios', page=usuarios.prev_num, sort_by=sort_by) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
          {% endif %}
      
          <!-- Mostrar página anterior (si no es la primera página) -->
          {% if usuarios.page > 1 %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('users.listar_usuarios', page=usuarios.page - 1, sort_by=sort_by) }}">
                {{ usuarios.page - 1 }}
              </a>
            </li>
          {% endif %}
      
          <!-- Mostrar página actual -->
          <li class="page-item active">
            <a class="page-link">{{ usuarios.page }}</a>
          </li>
      
          <!-- Mostrar página siguiente (si no es la última página) -->
          {% if usuarios.page < usuarios.pages %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('users.listar_usuarios', page=usuarios.page + 1, sort_by=sort_by) }}">
                {{ usuarios.page + 1 }}
              </a>
            </li>
          {% endif %}
      
          <!-- Botón para avanzar (solo si hay una página siguiente) -->
          {% if usuarios.has_next %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('users.listar_usuarios', page=usuarios.next_num, sort_by=sort_by) }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>      
{% endblock %}

{% block footer %}
    <footer>
        <p>&copy; 2024 Listado de Clientes</p>
    </footer>
{% endblock %}
